<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Register - WasteZero</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

    body {
      height: 100vh;
      background: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }

    #particles-js {
      position: absolute;
      width: 100%; height: 100%;
      z-index: -1;
    }

    .container {
      width: 780px;   /* ⬅ reduced */
      max-width: 95%;
      background: rgba(255,255,255,0.95);
      display: flex;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(119,114,114,0.6);
      z-index: 1;
    }

    .form-container {
      flex: 1; 
      padding: 16px;  /* ⬅ reduced */
    }

    h2 {
      text-align: center;
      margin-bottom: 18px;
      color: #2E7D32;
      font-size: 22px;  /* ⬅ smaller */
    }

    .form-group {
      margin-bottom: 8px; /* ⬅ tighter spacing */
    }

    .form-group label {
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
      color: #333;
      font-size: 13px;
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 8px 10px;  /* ⬅ reduced height */
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 13px;
      outline: none;
    }

    .form-group input:focus, .form-group select:focus {
      border-color: #2E7D32;
      box-shadow: 0 0 4px rgba(46,125,50,0.4);
    }

    button {
      width: 100%;
      padding: 8px;   /* ⬅ reduced */
      background: #2E7D32;
      color: white;
      font-size: 15px;
      font-weight: 600;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover { background: #134716; }

    #message {
      margin-top: 8px;
      font-size: 13px;
      color: #2E7D32;
      text-align: center;
      font-weight: 600;
    }

    .login-link {
      text-align: center;
      margin-top: 8px;
      font-size: 13px;
    }
    .login-link a {
      color: #2E7D32;
      text-decoration: none;
      font-weight: 600;
    }
    .login-link a:hover { text-decoration: underline; }

    .right-panel {
      flex: 1;
      background: linear-gradient(135deg, #2E7D32, #81C784);
      color: #fff;
      display: flex; flex-direction: column;
      justify-content: center; align-items: center;
      padding: 30px 20px;
      text-align: center;
    }
    .right-panel h3 { font-size: 26px; margin-bottom: 8px; }
    .right-panel p { font-size: 14px; line-height: 1.3; }

#verifyEmailBtn {
  padding: 4px 10px !important;
  font-size: 12px !important;
  background: #388E3C !important;
  color: white !important;
  border: none !important;
  border-radius: 6px !important;
  cursor: pointer !important;
  min-width: 70px !important;
  height: 26px !important;
  line-height: 1 !important;
}


    .verify-email-container button {
      width: auto;
      padding: 8px 15px;
      font-size: 13px;
      border-radius: 6px;
      background: #388E3C;
      transition: background 0.3s ease;
      min-width: 100px;
    }
    .verify-email-container button:hover {
      background: #1d6421;
    }

    .otp-popup-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.3);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    .otp-popup {
      background: #fff;
      border-radius: 10px;
      padding: 20px 25px;
      width: 320px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
      text-align: center;
      font-size: 14px;
    }
    .otp-popup h4 {
      margin-bottom: 15px;
      color: #2E7D32;
      font-weight: 700;
      font-size: 18px;
    }
    .otp-popup p {
      margin-bottom: 15px;
      font-weight: 600;
    }
    .otp-popup input[type="text"] {
      width: 80%;
      padding: 8px 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      outline: none;
      margin-bottom: 15px;
    }
    .otp-popup input[type="text"]:focus {
      border-color: #2E7D32;
      box-shadow: 0 0 5px rgba(46,125,50,0.4);
    }
    .otp-popup button {
      width: 45%;
      margin: 0 5px;
      font-size: 14px;
      padding: 8px 0;
      border-radius: 6px;
      font-weight: 600;
    }
    .otp-popup .btn-cancel {
      background: #ccc;
      color: #333;
    }
    .otp-popup .btn-cancel:hover {
      background: #aaa;
    }
    .otp-popup .btn-verify {
      background: #2E7D32;
      color: #fff;
    }
    .otp-popup .btn-verify:hover {
      background: #134716;
    }

    @media screen and (max-width: 768px) {
      .container { flex-direction: column; }
      .right-panel { display: none; }
    }
  </style>
</head>
<body>

  <div id="particles-js"></div>

  <div class="container">
    <div class="form-container">
      <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 12px;">
  <img src="logo.jpg" alt="WasteZero Logo" style="height: 40px;" />
  <h2 style="margin: 0;">Register to WasteZero</h2>
</div>
      <form id="registerForm">

        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" name="username" placeholder="Enter username" required />
        </div>

<div class="form-group verify-email-container" style="display: flex; justify-content: space-between; align-items: center;">
  <label for="email" style="font-weight: 600; font-size: 13px; color: #333; margin: 0;">
    Email
  </label>
  <button type="button" id="verifyEmailBtn">Verify</button>
</div>
<input type="email" id="email" name="email" placeholder="Enter email" required style="margin-top: 6px; padding: 8px 10px; font-size: 13px; border: 1px solid #ccc; border-radius: 6px; width: 100%;" />
<p id="verifyStatus" style="font-size: 13px; color: #2E7D32; font-weight: 600; margin-top: 4px;"></p>

        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" name="password" placeholder="Enter password" required />
        </div>
        <div class="form-group">
          <label for="role">Role</label>
          <input type="text" id="role" name="role" placeholder="e.g. Student, Manager" required />
        </div>
        <div class="form-group">
          <label for="skills">Skills</label>
          <input type="text" id="skills" name="skills" placeholder="e.g. HTML, CSS, JavaScript" />
        </div>
        <div class="form-group">
          <label for="location">Location</label>
          <input type="text" id="location" name="location" placeholder="Enter location" />
        </div>
        <div class="form-group">
          <label for="gender">Gender</label>
          <select id="gender" name="gender" required>
            <option value="">Select gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <button type="submit">Register</button>
      </form>
      <p id="message"></p>

      <div class="login-link">
        Already have an account? <a href="/login.html">Login</a>
      </div>
    </div>

    <div class="right-panel">
  <img src="logo2.png" alt="Zero Waste Logo" style="height: 80px; margin-bottom: 18px;" />
  <h3>Welcome to WasteZero</h3>
  <p>Smart Waste Pickup & Recycling Platform</p>
</div>

  <!-- OTP popup -->
  <div class="otp-popup-overlay" id="otpPopup">
    <div class="otp-popup">
      <h4>Verify Your Email</h4>
      <p>An OTP has been sent. Please enter it below:</p>
      <input type="text" id="otpInput" maxlength="6" placeholder="Enter 6-digit OTP" />
      <div>
        <button class="btn-verify" id="otpVerifyBtn">Verify</button>
        <button class="btn-cancel" id="otpCancelBtn">Cancel</button>
      </div>
      <p id="otpErrorMsg" style="color:#D32F2F; margin-top: 10px; font-weight: 600; font-size: 13px;"></p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script>
const form = document.getElementById('registerForm');
const verifyEmailBtn = document.getElementById('verifyEmailBtn');
const verifyStatus = document.getElementById('verifyStatus');
const otpPopup = document.getElementById('otpPopup');
const otpInput = document.getElementById('otpInput');
const otpVerifyBtn = document.getElementById('otpVerifyBtn');
const otpCancelBtn = document.getElementById('otpCancelBtn');
const otpErrorMsg = document.getElementById('otpErrorMsg');
const emailInput = document.getElementById('email');

let emailVerified = false;

// 📩 Send OTP when "Verify" button is clicked
verifyEmailBtn.addEventListener('click', async () => {
  const email = emailInput.value.trim();

  if (!email) {
    alert('Please enter an email address.');
    emailInput.focus();
    return;
  }

  if (emailVerified) {
    alert('Email already verified!');
    return;
  }

  try {
    const response = await fetch('/send-otp', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email }),
    });

    if (response.ok) {
      otpInput.value = '';
      otpErrorMsg.textContent = '';
      otpPopup.style.display = 'flex';
    } else {
      const errorText = await response.text();
      alert('Failed to send OTP: ' + errorText);
    }
  } catch (error) {
    alert('Error sending OTP. Please try again.');
    console.error(error);
  }
});

// ✅ Handle OTP verification
otpVerifyBtn.addEventListener('click', async () => {
  const otp = otpInput.value.trim();
  const email = emailInput.value.trim();

  if (!otp) {
    otpErrorMsg.textContent = 'Please enter the OTP.';
    return;
  }

  try {
    const response = await fetch('/verify-otp', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, otp }),
    });

    if (response.ok) {
      emailVerified = true;
      verifyStatus.textContent = '✅ Email Verified';
      verifyEmailBtn.textContent = 'Verified';
      verifyEmailBtn.disabled = true;
      otpPopup.style.display = 'none';
      otpErrorMsg.textContent = '';
    } else {
      const errorText = await response.text();
      otpErrorMsg.textContent = errorText || 'Incorrect OTP. Try again.';
    }
  } catch (error) {
    otpErrorMsg.textContent = 'Error verifying OTP.';
    console.error(error);
  }
});

// ❌ Cancel OTP popup
otpCancelBtn.addEventListener('click', () => {
  otpPopup.style.display = 'none';
  otpErrorMsg.textContent = '';
});

// 📝 Handle form submission
form.addEventListener('submit', async (e) => {
  e.preventDefault();

  if (!emailVerified) {
    document.getElementById('message').innerText = '⚠ Please verify your email first.';
    return;
  }

  const userData = {
    username: document.getElementById('username').value.trim(),
    email: emailInput.value.trim(),
    password: document.getElementById('password').value.trim(),
    role: document.getElementById('role').value.trim(),
    skills: document.getElementById('skills').value.trim(),
    location: document.getElementById('location').value.trim(),
    gender: document.getElementById('gender').value.trim()
  };

  if (!userData.gender) {
    document.getElementById('message').innerText = "Please select a gender.";
    return;
  }

  try {
    const response = await fetch('/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(userData),
    });

    if (response.status === 201) {
      document.getElementById('message').innerText = '✅ Registered successfully! Redirecting...';
      form.reset();
      verifyStatus.textContent = '';
      emailVerified = false;
      verifyEmailBtn.textContent = 'Verify Email';
      verifyEmailBtn.disabled = false;
      setTimeout(() => {
        window.location.href = '/login.html';
      }, 2000);
    } else {
      const errorText = await response.text();
      document.getElementById('message').innerText = errorText;
    }
  } catch (error) {
    document.getElementById('message').innerText = 'Server error during registration.';
    console.error(error);
  }
});

// 🌟 Initialize Particles.js
particlesJS("particles-js", {
  "particles": {
    "number": { "value": 25, "density": { "enable": true, "value_area": 800 } },
    "shape": {
      "type": "image",
      "image": {
        "src": "https://img.icons8.com/emoji/48/recycling-symbol-emoji.png",
        "width": 48,
        "height": 48
      }
    },
    "opacity": { "value": 0.6, "random": true },
    "size": { "value": 18, "random": true },
    "move": { "enable": true, "speed": 1, "random": true, "out_mode": "out" }
  },
  "interactivity": {
    "events": {
      "onhover": { "enable": false },
      "onclick": { "enable": false }
    }
  },
  "retina_detect": true
});
</script>

</body>
</html>